{% extends "admin/base_site.html" %}
{% load i18n admin_urls admin_static admin_modify %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
{% endblock %}

{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% if not is_popup %}
	{% block breadcrumbs %}
		<div class="breadcrumbs">
			<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
			&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
			&rsaquo; {% if has_change_permission %}<a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %}
			&rsaquo; {% if has_change_permission %}<a href="{% url 'admin:forum_forum_change' forum.id %}">{{ forum.name }}</a>{% endif %}
			&rsaquo; {% if has_change_permission %}{% trans "Forum permissions" %}{% endif %}
		</div>
	{% endblock %}
{% endif %}

{% block content %}
	<form action="." method="post" id="{{ opts.model_name }}_pick_user_form" novalidate>{% csrf_token %}
		<div>
			<fieldset class="module aligned {{ fieldset.classes }}">
			    <h2>{% trans "Edit user permissions" %}</h2>
			    <div class="description">{% trans "Please select a user in order to update its permissions" %}</div>
	            {% for field in user_form %}
	            	<div class="form-row">
		                <div {% if field.is_checkbox %} class="checkbox-row"{% else %} class="field-box field-{{ field.name }}{% if not field.is_readonly and field.errors %} errors{% endif %}{% if field.is_hidden %} hidden{% endif %}"{% endif %}>
		                    {% if not field.is_readonly %}{{ field.errors }}{% endif %}
		                    {% if field.is_checkbox %}
		                        {{ field.field }}{{ field.label_tag }}
		                    {% else %}
		                        {{ field.label_tag }}
		                        {{ field }}
		                    {% endif %}
		                    {% if field.field.help_text %}
		                        <p class="help">{{ field.field.help_text|safe }}</p>
		                    {% endif %}
		                </div>
	                </div>
	            {% endfor %}
			</fieldset>
		</div>
		<div class="submit-row">
			<input type="submit" value="{% trans 'Select' %}" class="default" name="_select_user" />
		</div>
	</form>
	<form action="." method="post" id="{{ opts.model_name }}_pick_group_form" novalidate>{% csrf_token %}
		<div>
			<fieldset class="module aligned {{ fieldset.classes }}">
			    <h2>{% trans "Edit group permissions" %}</h2>
			    <div class="description">{% trans "Please select a group in order to update its permissions" %}</div>
	            {% for field in group_form %}
	            	<div class="form-row">
		                <div {% if field.is_checkbox %} class="checkbox-row"{% else %} class="field-box field-{{ field.name }}{% if not field.is_readonly and field.errors %} errors{% endif %}{% if field.is_hidden %} hidden{% endif %}"{% endif %}>
		                    {% if not field.is_readonly %}{{ field.errors }}{% endif %}
		                    {% if field.is_checkbox %}
		                        {{ field.field }}{{ field.label_tag }}
		                    {% else %}
		                        {{ field.label_tag }}
		                        {{ field }}
		                    {% endif %}
		                    {% if field.field.help_text %}
		                        <p class="help">{{ field.field.help_text|safe }}</p>
		                    {% endif %}
		                </div>
	                </div>
	            {% endfor %}
			</fieldset>
		</div>
		<div class="submit-row">
			<input type="submit" value="{% trans 'Select' %}" class="default" name="_select_group" />
		</div>
	</form>

    <script type="text/javascript">
        (function($) {
            $(document).ready(function() {
                $('.related-lookup').click(function(e) {
                    e.preventDefault();
                    var event = $.Event('django:lookup-related');
                    $(this).trigger(event);
                    if (!event.isDefaultPrevented()) {
                        showRelatedObjectLookupPopup(this);
                    }
                });
            });
        })(django.jQuery);
    </script>
{% endblock content %}